(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{119:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return s})),n.d(t,"metadata",(function(){return i})),n.d(t,"toc",(function(){return l})),n.d(t,"default",(function(){return p}));var o=n(3),a=n(7),r=(n(0),n(168)),c=["components"],s={id:"ops",title:"Continuous Integration",sidebar_label:"Continuous Integration"},i={unversionedId:"dev/ops",id:"dev/ops",isDocsHomePage:!1,title:"Continuous Integration",description:"Please do not feel intimidated by the thought of having to make your code pass the CI tests! The core developer team is happy to work closely with contributors to integrate their code and merge PRs.",source:"@site/docs/dev/ops.md",slug:"/dev/ops",permalink:"/dev/ops",editUrl:"https://github.com/facebookincubator/flowtorch/edit/main/website/docs/dev/ops.md",version:"current",sidebar_label:"Continuous Integration",sidebar:"devsSidebar",previous:{title:"Overview",permalink:"/dev/overview"},next:{title:"Docs",permalink:"/dev/docs"}},l=[{value:"Workflow Steps",id:"workflow-steps",children:[]},{value:"Successful Commits",id:"successful-commits",children:[{value:"Run Tests",id:"run-tests",children:[]},{value:"Check Types",id:"check-types",children:[]},{value:"Formatting and Linting",id:"formatting-and-linting",children:[]}]}],b={toc:l};function p(e){var t=e.components,n=Object(a.a)(e,c);return Object(r.b)("wrapper",Object(o.a)({},b,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("div",{className:"admonition admonition-info alert alert--info"},Object(r.b)("div",{parentName:"div",className:"admonition-heading"},Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",{parentName:"h5",className:"admonition-icon"},Object(r.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(r.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),Object(r.b)("div",{parentName:"div",className:"admonition-content"},Object(r.b)("p",{parentName:"div"},"Please do not feel intimidated by the thought of having to make your code pass the CI tests! The core developer team is happy to work closely with contributors to integrate their code and merge PRs."))),Object(r.b)("p",null,"FlowTorch uses ",Object(r.b)("a",{parentName:"p",href:"https://docs.github.com/en/actions"},"GitHub Actions")," to run code quality tests on pushes or pull requests to the ",Object(r.b)("inlineCode",{parentName:"p"},"main")," branch, a process known as ",Object(r.b)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Continuous_integration"},"continuous integration")," (CI). The tests are run for Python versions 3.7, 3.8, and 3.9, and must be successful for a PR to be merged into ",Object(r.b)("inlineCode",{parentName:"p"},"main"),". All workflow runs can be viewed ",Object(r.b)("a",{parentName:"p",href:"https://github.com/facebookincubator/flowtorch/actions"},"here"),", or else viewed from the link at the bottom of the ",Object(r.b)("a",{parentName:"p",href:"https://github.com/facebookincubator/flowtorch/pulls"},"PR")," in question."),Object(r.b)("h2",{id:"workflow-steps"},"Workflow Steps"),Object(r.b)("p",null,"The definition of the steps performed in the build workflow is found ",Object(r.b)("a",{parentName:"p",href:"https://github.com/facebookincubator/flowtorch/blob/main/.github/workflows/python-package.yml"},"here")," and is as follows:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"The version of Python (3.7, 3.8, or 3.9) is installed along with the developer dependencies of FlowTorch;")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"python -m pip install --upgrade pip\npython -m pip install flake8 black usort pytest mypy\npip install numpy\npip install --pre torch torchvision torchaudio\npip install -e .[dev]\n")),Object(r.b)("ol",{start:2},Object(r.b)("li",{parentName:"ol"},"Each Python source is checked for containing the mandatory copyright header by a ",Object(r.b)("a",{parentName:"li",href:"https://github.com/facebookincubator/flowtorch/blob/main/scripts/copyright_headers.py"},"custom script"),":")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"python scripts/copyright_headers.py --check flowtorch tests scripts examples\n")),Object(r.b)("ol",{start:3},Object(r.b)("li",{parentName:"ol"},"The formatting of the Python code in the ",Object(r.b)("a",{parentName:"li",href:"https://github.com/facebookincubator/flowtorch/tree/main/flowtorch"},"library")," and ",Object(r.b)("a",{parentName:"li",href:"https://github.com/facebookincubator/flowtorch/tree/main/tests"},"tests")," is checked to ensure it follows a standard using ",Object(r.b)("a",{parentName:"li",href:"https://black.readthedocs.io/en/stable/"},Object(r.b)("inlineCode",{parentName:"a"},"black")),";")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"black --check flowtorch tests\n")),Object(r.b)("ol",{start:4},Object(r.b)("li",{parentName:"ol"},"Likewise, the order and formatting of Python ",Object(r.b)("inlineCode",{parentName:"li"},"import")," statements in the same folders is checked to ensure it follows a standard using ",Object(r.b)("a",{parentName:"li",href:"https://usort.readthedocs.io/en/stable/"},Object(r.b)("inlineCode",{parentName:"a"},"usort")),";")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"usort check flowtorch tests\n")),Object(r.b)("ol",{start:5},Object(r.b)("li",{parentName:"ol"},"A ",Object(r.b)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Static_program_analysis"},"static code analysis"),", or rather, linting, is performed by ",Object(r.b)("a",{parentName:"li",href:"https://flake8.pycqa.org/en/latest/"},Object(r.b)("inlineCode",{parentName:"a"},"flake8"))," to find potential bugs;")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"flake8 . tests --count --show-source --statistics\n")),Object(r.b)("ol",{start:6},Object(r.b)("li",{parentName:"ol"},"FlowTorch makes use of type hints, which we consider mandatory for all contributed code, and static types are checked with ",Object(r.b)("a",{parentName:"li",href:"https://github.com/python/mypy"},Object(r.b)("inlineCode",{parentName:"a"},"mypy")),";")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"mypy --disallow-untyped-defs flowtorch\n")),Object(r.b)("ol",{start:7},Object(r.b)("li",{parentName:"ol"},"Unit tests:")),Object(r.b)("p",null,"pytest + XML coverage report"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"pytest --cov=tests --cov-report=xml -W ignore::DeprecationWarning tests/\n")),Object(r.b)("ol",{start:8},Object(r.b)("li",{parentName:"ol"},"The coverage report is uploaded to ",Object(r.b)("a",{parentName:"li",href:"https://about.codecov.io/"},"Codecov")," with a ",Object(r.b)("a",{parentName:"li",href:"https://github.com/codecov/codecov-action"},"GitHub Action"),". This allows us to analyze the results and produce the percentage of code covered badge.")),Object(r.b)("p",null,"If any step fails, the workflow fails and you will not be able to merge the PR into ",Object(r.b)("inlineCode",{parentName:"p"},"main"),"."),Object(r.b)("h2",{id:"successful-commits"},"Successful Commits"),Object(r.b)("p",null,"To ensure your PR passes, you should perform these steps ",Object(r.b)("em",{parentName:"p"},"before pushing your local commits to the remote branch"),"."),Object(r.b)("h3",{id:"run-tests"},"Run Tests"),Object(r.b)("p",null,"Run the tests first so that you can do the code formatting just once as the final step:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"pytest tests -W ignore::DeprecationWarning\n")),Object(r.b)("p",null,"Fix any failing tests until the above command succeeds."),Object(r.b)("h3",{id:"check-types"},"Check Types"),Object(r.b)("p",null,"Check that there are no errors with the type hints:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"mypy --disallow-untyped-defs flowtorch\n")),Object(r.b)("p",null,"I find this is one of the most difficult steps to make pass - if you require assistance, comment on your PR, tagging the core developers."),Object(r.b)("h3",{id:"formatting-and-linting"},"Formatting and Linting"),Object(r.b)("p",null,"Having ensured the tests and docs are correct, run the following commands to standardize your code's formatting:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"black flowtorch tests\nusort format flowtorch tests\n")),Object(r.b)("p",null,"Now, run these commands in check mode to ensure there are no errors:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"black --check flowtorch tests\nusort check flowtorch tests\n")),Object(r.b)("p",null,"It is possible you may need to fix some errors by hand."),Object(r.b)("p",null,"Finally, run the linter and fix any resulting errors:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"flake8 flowtorch tests\n")),Object(r.b)("p",null,"At this point, you are ready to commit your changes and push to the remote branch - you're a star! \u2b50 From there, your PR will be reviewed by the core developers and after any modifications are made, merged to the ",Object(r.b)("inlineCode",{parentName:"p"},"main")," branch."))}p.isMDXComponent=!0},168:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return d}));var o=n(0),a=n.n(o);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=a.a.createContext({}),b=function(e){var t=a.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=b(e.components);return a.a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},h=a.a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,c=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),p=b(n),h=o,d=p["".concat(c,".").concat(h)]||p[h]||u[h]||r;return n?a.a.createElement(d,s(s({ref:t},l),{},{components:n})):a.a.createElement(d,s({ref:t},l))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,c=new Array(r);c[0]=h;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s.mdxType="string"==typeof e?e:o,c[1]=s;for(var l=2;l<r;l++)c[l]=n[l];return a.a.createElement.apply(null,c)}return a.a.createElement.apply(null,n)}h.displayName="MDXCreateElement"}}]);