(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{115:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return c})),a.d(t,"metadata",(function(){return i})),a.d(t,"toc",(function(){return l})),a.d(t,"default",(function(){return p}));var n=a(3),o=a(7),r=(a(0),a(154)),s=["components"],c={id:"ops",title:"Continuous Integration",sidebar_label:"Continuous Integration"},i={unversionedId:"dev/ops",id:"dev/ops",isDocsHomePage:!1,title:"Continuous Integration",description:"FlowTorch uses GitHub Actions to run code quality tests on pushes or pull requests to the master branch, a process known as continuous integration (CI). The tests are run for Python versions 3.6, 3.7, and 3.8, and must be successful for a PR to be merged into master. All workflow runs can be viewed here, or else viewed from the link at the bottom of the PR in question.",source:"@site/docs/dev/ops.md",slug:"/dev/ops",permalink:"/dev/ops",editUrl:"https://github.com/facebookincubator/flowtorch/edit/master/website/docs/dev/ops.md",version:"current",sidebar_label:"Continuous Integration",sidebar:"devsSidebar",previous:{title:"Overview",permalink:"/dev/overview"},next:{title:"Bijector Interface",permalink:"/dev/bijector"}},l=[{value:"Workflow Steps",id:"workflow-steps",children:[]},{value:"Successful Commits",id:"successful-commits",children:[{value:"Run Tests",id:"run-tests",children:[]},{value:"Check Types",id:"check-types",children:[]},{value:"Build Docs",id:"build-docs",children:[]},{value:"Formatting and Linting",id:"formatting-and-linting",children:[]}]}],b={toc:l};function p(e){var t=e.components,a=Object(o.a)(e,s);return Object(r.b)("wrapper",Object(n.a)({},b,a,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"FlowTorch uses ",Object(r.b)("a",{parentName:"p",href:"https://docs.github.com/en/actions"},"GitHub Actions")," to run code quality tests on pushes or pull requests to the ",Object(r.b)("inlineCode",{parentName:"p"},"master")," branch, a process known as ",Object(r.b)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Continuous_integration"},"continuous integration")," (CI). The tests are run for Python versions 3.6, 3.7, and 3.8, and must be successful for a PR to be merged into ",Object(r.b)("inlineCode",{parentName:"p"},"master"),". All workflow runs can be viewed ",Object(r.b)("a",{parentName:"p",href:"https://github.com/facebookincubator/flowtorch/actions"},"here"),", or else viewed from the link at the bottom of the ",Object(r.b)("a",{parentName:"p",href:"https://github.com/facebookincubator/flowtorch/pulls"},"PR")," in question."),Object(r.b)("div",{className:"admonition admonition-info alert alert--info"},Object(r.b)("div",{parentName:"div",className:"admonition-heading"},Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",{parentName:"h5",className:"admonition-icon"},Object(r.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(r.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),Object(r.b)("div",{parentName:"div",className:"admonition-content"},Object(r.b)("p",{parentName:"div"},"Please do not feel intimidated by the thought of having to make your code pass the CI tests! The core developer team is happy to work closely with contributors to integrate their code and merge PRs."))),Object(r.b)("h2",{id:"workflow-steps"},"Workflow Steps"),Object(r.b)("p",null,"The definition of the steps performed in the build workflow is found ",Object(r.b)("a",{parentName:"p",href:"https://github.com/facebookincubator/flowtorch/blob/master/.github/workflows/python-package.yml"},"here")," and is as follows:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"The version of Python (3.6, 3.7, or 3.8) is installed along with the developer dependencies of FlowTorch;")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"python -m pip install --upgrade pip\npython -m pip install flake8 black usort pytest mypy\npip install numpy\npip install --pre torch torchvision torchaudio -f https://download.pytorch.org/whl/nightly/cpu/torch_nightly.html\npip install -e .[dev]\n")),Object(r.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(r.b)("div",{parentName:"div",className:"admonition-heading"},Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",{parentName:"h5",className:"admonition-icon"},Object(r.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(r.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),Object(r.b)("div",{parentName:"div",className:"admonition-content"},Object(r.b)("p",{parentName:"div"},"Currently, FlowTorch requires the nightly build of PyTorch since it depends on features of ",Object(r.b)("a",{parentName:"p",href:"https://github.com/pytorch/pytorch/blob/master/torch/distributions/transforms.py"},Object(r.b)("inlineCode",{parentName:"a"},"torch.distributions.transforms"))," that have not yet been released in a stable version."))),Object(r.b)("ol",{start:2},Object(r.b)("li",{parentName:"ol"},"The formatting of the Python code in the ",Object(r.b)("a",{parentName:"li",href:"https://github.com/facebookincubator/flowtorch/tree/master/flowtorch"},"library")," and ",Object(r.b)("a",{parentName:"li",href:"https://github.com/facebookincubator/flowtorch/tree/master/tests"},"tests")," is checked to ensure it follows a standard using ",Object(r.b)("a",{parentName:"li",href:"https://black.readthedocs.io/en/stable/"},Object(r.b)("inlineCode",{parentName:"a"},"black")),";")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"black --check flowtorch tests\n")),Object(r.b)("ol",{start:3},Object(r.b)("li",{parentName:"ol"},"Likewise, the order and formatting of Python ",Object(r.b)("inlineCode",{parentName:"li"},"import")," statements in the same folders is checked to ensure it follows a standard using ",Object(r.b)("a",{parentName:"li",href:"https://usort.readthedocs.io/en/stable/"},Object(r.b)("inlineCode",{parentName:"a"},"usort")),";")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"usort flowtorch tests\n")),Object(r.b)("ol",{start:4},Object(r.b)("li",{parentName:"ol"},"A ",Object(r.b)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Static_program_analysis"},"static code analysis"),", or rather, linting, is performed by ",Object(r.b)("a",{parentName:"li",href:"https://flake8.pycqa.org/en/latest/"},Object(r.b)("inlineCode",{parentName:"a"},"flake8"))," to find potential bugs;")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"flake8 flowtorch tests --count --show-source --statistics\n")),Object(r.b)("ol",{start:5},Object(r.b)("li",{parentName:"ol"},"FlowTorch makes use of type hints, which we consider mandatory for all contributed code, and static types are checked with ",Object(r.b)("a",{parentName:"li",href:"https://github.com/python/mypy"},Object(r.b)("inlineCode",{parentName:"a"},"mypy")),";")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"mypy flowtorch\n")),Object(r.b)("ol",{start:6},Object(r.b)("li",{parentName:"ol"},"Unit tests")),Object(r.b)("p",null,"pytest + XML coverage report"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"pytest --cov=tests --cov-report=xml -W ignore::DeprecationWarning\n")),Object(r.b)("ol",{start:7},Object(r.b)("li",{parentName:"ol"},"The coverage report is uploaded to ",Object(r.b)("a",{parentName:"li",href:"https://about.codecov.io/"},"Codecov")," with a ",Object(r.b)("a",{parentName:"li",href:"https://github.com/codecov/codecov-action"},"GitHub Action"),". This allows us to analyze the results and produce the percentage of code covered badge.")),Object(r.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(r.b)("div",{parentName:"div",className:"admonition-heading"},Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",{parentName:"h5",className:"admonition-icon"},Object(r.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(r.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),Object(r.b)("div",{parentName:"div",className:"admonition-content"},Object(r.b)("p",{parentName:"div"},"Uploading code coverage report to ",Object(r.b)("inlineCode",{parentName:"p"},"codecov.io")," and viewing results has not yet been tested!"))),Object(r.b)("ol",{start:8},Object(r.b)("li",{parentName:"ol"},"An API reference is generated automatically from the code's docstrings with ",Object(r.b)("a",{parentName:"li",href:"https://www.sphinx-doc.org/en/master/"},"Sphinx"),".")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"cd docs\nsphinx-apidoc -o source ../flowtorch/\nmake html\n")),Object(r.b)("p",null,"If any step fails, the workflow fails and it is inadvisable for the PR to be merged into ",Object(r.b)("inlineCode",{parentName:"p"},"master"),"."),Object(r.b)("h2",{id:"successful-commits"},"Successful Commits"),Object(r.b)("p",null,"To ensure your PR passes, you should perform these steps ",Object(r.b)("em",{parentName:"p"},"before pushing your local commits to the remote branch"),"."),Object(r.b)("h3",{id:"run-tests"},"Run Tests"),Object(r.b)("p",null,"Run the tests first so that you can do the code formatting just once as the final step:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"pytest tests -W ignore::DeprecationWarning\n")),Object(r.b)("p",null,"Fix any failing tests until the above command succeeds."),Object(r.b)("h3",{id:"check-types"},"Check Types"),Object(r.b)("p",null,"Check that there are no errors with the type hints:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"mypy flowtorch\n")),Object(r.b)("p",null,"I find this is one of the most difficult steps to make pass - if you require assistance, comment on your PR, tagging the core developers."),Object(r.b)("h3",{id:"build-docs"},"Build Docs"),Object(r.b)("p",null,"Check that the docs build successfully and fix any errors:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"cd docs\nsphinx-apidoc -o source ../flowtorch/\n")),Object(r.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(r.b)("div",{parentName:"div",className:"admonition-heading"},Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",{parentName:"h5",className:"admonition-icon"},Object(r.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(r.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),Object(r.b)("div",{parentName:"div",className:"admonition-content"},Object(r.b)("p",{parentName:"div"},"Currently, the Sphinx output is not integrated with the ",Object(r.b)("a",{parentName:"p",href:"https://flowtorch.ai/api"},"Docusaurus v2 website"),". In a future release, we would like to both automate this integration plus the deployment of the website when a PR is merged to ",Object(r.b)("inlineCode",{parentName:"p"},"master"),". In the meanwhile, core developers can run ",Object(r.b)("a",{parentName:"p",href:"https://github.com/facebookincubator/flowtorch/blob/master/deploy-website-windows.bat"},"this script")," (on Windows) - more instructions ",Object(r.b)("a",{parentName:"p",href:"https://github.com/facebookincubator/flowtorch/tree/master/website"},"here"),"."))),Object(r.b)("h3",{id:"formatting-and-linting"},"Formatting and Linting"),Object(r.b)("p",null,"Having ensured the tests and docs are correct, run the following commands to standardize your code's formatting:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"black flowtorch tests\nusort flowtorch tests\n")),Object(r.b)("p",null,"Now, run these commands in check mode to ensure there are no errors:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"black --check flowtorch tests\nusort --check flowtorch tests\n")),Object(r.b)("p",null,"It is possible you may need to fix some errors by hand."),Object(r.b)("p",null,"Finally, run the linter and fix any resulting errors:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"flake8 flowtorch tests\n")),Object(r.b)("p",null,"At this point, you are ready to commit your changes and push to the remote branch - you're a star! \u2b50 From there, your PR will be reviewed by the core developers and after any modifications are made, merged to the ",Object(r.b)("inlineCode",{parentName:"p"},"master")," branch."))}p.isMDXComponent=!0},154:function(e,t,a){"use strict";a.d(t,"a",(function(){return p})),a.d(t,"b",(function(){return m}));var n=a(0),o=a.n(n);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var l=o.a.createContext({}),b=function(e){var t=o.a.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):c(c({},t),e)),a},p=function(e){var t=b(e.components);return o.a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},h=o.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,r=e.originalType,s=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),p=b(a),h=n,m=p["".concat(s,".").concat(h)]||p[h]||d[h]||r;return a?o.a.createElement(m,c(c({ref:t},l),{},{components:a})):o.a.createElement(m,c({ref:t},l))}));function m(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var r=a.length,s=new Array(r);s[0]=h;var c={};for(var i in t)hasOwnProperty.call(t,i)&&(c[i]=t[i]);c.originalType=e,c.mdxType="string"==typeof e?e:n,s[1]=c;for(var l=2;l<r;l++)s[l]=a[l];return o.a.createElement.apply(null,s)}return o.a.createElement.apply(null,a)}h.displayName="MDXCreateElement"}}]);