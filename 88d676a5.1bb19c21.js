(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{111:function(e,a,t){"use strict";t.r(a),t.d(a,"frontMatter",(function(){return b})),t.d(a,"metadata",(function(){return r})),t.d(a,"toc",(function(){return c})),t.d(a,"default",(function(){return l}));var s=t(3),n=t(7),m=(t(0),t(168)),p=["components"],b={id:"shapes",title:"Shapes",sidebar_label:"Shapes"},r={unversionedId:"users/shapes",id:"users/shapes",isDocsHomePage:!1,title:"Shapes",description:"One of the advantages of using FlowTorch is that we have carefully thought out how shape information is propagated from the base distribution through the sequence of bijective transforms. Before we explain how shapes are handled in FlowTorch, let us revisit the shape conventions shared across PyTorch and TensorFlow.",source:"@site/docs/users/shapes.mdx",slug:"/users/shapes",permalink:"/users/shapes",editUrl:"https://github.com/facebookincubator/flowtorch/edit/main/website/docs/users/shapes.mdx",version:"current",sidebar_label:"Shapes",sidebar:"usersSidebar",previous:{title:"Table of Methods",permalink:"/users/methods"},next:{title:"Constraints",permalink:"/users/constraints"}},c=[{value:"Shape Conventions",id:"shape-conventions",children:[]},{value:"Examples",id:"examples",children:[]},{value:"Non-conditional Transformed Distributions",id:"non-conditional-transformed-distributions",children:[]},{value:"Conditional Transformed Distributions",id:"conditional-transformed-distributions",children:[]}],i={toc:c};function l(e){var a=e.components,t=Object(n.a)(e,p);return Object(m.b)("wrapper",Object(s.a)({},i,t,{components:a,mdxType:"MDXLayout"}),Object(m.b)("p",null,"One of the advantages of using FlowTorch is that we have carefully thought out how shape information is propagated from the base distribution through the sequence of bijective transforms. Before we explain how shapes are handled in FlowTorch, let us revisit the shape conventions shared across PyTorch and TensorFlow."),Object(m.b)("h2",{id:"shape-conventions"},"Shape Conventions"),Object(m.b)("p",null,"FlowTorch shares the shape conventions of PyTorch's ",Object(m.b)("a",{parentName:"p",href:"https://pytorch.org/docs/stable/distributions.html#distribution"},Object(m.b)("inlineCode",{parentName:"a"},"torch.distributions.Distribution"))," and TensorFlow's ",Object(m.b)("a",{parentName:"p",href:"https://www.tensorflow.org/probability/api_docs/python/tfp/distributions/Distribution"},Object(m.b)("inlineCode",{parentName:"a"},"tfp.distributions.Distribution"))," for representing random distributions. In these conventions, the shape of a tensor sampled from a random distribution is divided into three parts: the ",Object(m.b)("em",{parentName:"p"},"sample shape"),", the ",Object(m.b)("em",{parentName:"p"},"batch shape"),", and the ",Object(m.b)("em",{parentName:"p"},"event shape"),"."),Object(m.b)("p",null,"As described in the ",Object(m.b)("a",{parentName:"p",href:"https://www.tensorflow.org/probability/examples/Understanding_TensorFlow_Distributions_Shapes#basics"},"TensorFlow documentation"),","),Object(m.b)("ul",null,Object(m.b)("li",{parentName:"ul"},"Event shape describes the shape of a single draw from the distribution, which may or may not be dependent across dimensions."),Object(m.b)("li",{parentName:"ul"},'Batch shape describes independent, not identically distributed draws, that is, a "batch" of distributions.'),Object(m.b)("li",{parentName:"ul"},"Sample shape describes independent, identically distributed draws of batches from the distribution family.")),Object(m.b)("h2",{id:"examples"},"Examples"),Object(m.b)("p",null,"This is best illustrated with some simple examples. Let's begin with a standard normal distribution:"),Object(m.b)("pre",null,Object(m.b)("code",{parentName:"pre",className:"language-python"},"import torch\nimport torch.distributions as dist\nd = dist.Normal(loc=0, scale=1)\nsample_shape = torch.Size([])\n\n# Output: torch.Size([]) torch.Size([]) torch.Size([])\nprint(d.sample(sample_shape).shape, d.batch_shape, d.event_shape)\n")),Object(m.b)("p",null,"In this example, we have a single scalar normal distribution from which we draw a scalar sample. Since it is a scalar distribution, the ",Object(m.b)("inlineCode",{parentName:"p"},"event_shape = torch.Size([])"),". Since it is a single distribution, ",Object(m.b)("inlineCode",{parentName:"p"},"batch_shape = torch.Size([])"),". And we draw a scalar sample since ",Object(m.b)("inlineCode",{parentName:"p"},"sample_shape = torch.Size([])"),"."),Object(m.b)("p",null,"Note that the event shape and batch shape are properties of the distribution itself, whereas the sample shape depends on the size argument passed to ",Object(m.b)("a",{parentName:"p",href:"https://pytorch.org/docs/stable/distributions.html#torch.distributions.distribution.Distribution.sample"},Object(m.b)("inlineCode",{parentName:"a"},"Distribution.sample"))," or ",Object(m.b)("a",{parentName:"p",href:"https://pytorch.org/docs/stable/distributions.html#torch.distributions.distribution.Distribution.rsample"},Object(m.b)("inlineCode",{parentName:"a"},"Distribution.rsample")),". Also, the shape of ",Object(m.b)("inlineCode",{parentName:"p"},"d.sample(sample_shape)")," is the concatenation of the ",Object(m.b)("inlineCode",{parentName:"p"},"sample_shape"),", ",Object(m.b)("inlineCode",{parentName:"p"},"batch_shape"),", and ",Object(m.b)("inlineCode",{parentName:"p"},"event_shape"),", in that order."),Object(m.b)("p",null,"Let's look at another example:"),Object(m.b)("pre",null,Object(m.b)("code",{parentName:"pre",className:"language-python"},"d = dist.Normal(loc=torch.zeros(1), scale=torch.ones(1))\nsample_shape = torch.Size([2])\n\n# Output: torch.Size([2, 1]) torch.Size([1]) torch.Size([])\nprint(d.sample(sample_shape).shape, d.batch_shape, d.event_shape)\n")),Object(m.b)("p",null,"In this case, ",Object(m.b)("inlineCode",{parentName:"p"},"event_shape = torch.Size([])")," since we have a scalar distribution, but ",Object(m.b)("inlineCode",{parentName:"p"},"batch_shape = torch.Size([1])")," since we have tensor of parameters of that shape defining the distribution. Also, ",Object(m.b)("inlineCode",{parentName:"p"},"sample_shape = torch.Size([2])")," so that ",Object(m.b)("inlineCode",{parentName:"p"},"d.sample(sample_shape).shape = torch.Size([2, 1])"),"."),Object(m.b)("p",null,"A further example:"),Object(m.b)("pre",null,Object(m.b)("code",{parentName:"pre",className:"language-python"},"d = dist.Normal(loc=torch.zeros(2, 5), scale=torch.ones(2, 5))\nsample_shape = torch.Size([3, 4])\n\n# Output: torch.Size([3, 4, 2, 5]) torch.Size([2, 5]) torch.Size([])\nprint(d.sample(sample_shape).shape, d.batch_shape, d.event_shape)\n")),Object(m.b)("p",null,"We see that batch shapes, sample shapes (and event shapes) can have an arbitrary number of dimensions are are not restricted to being vectors."),Object(m.b)("p",null,"Is the event shape always ",Object(m.b)("inlineCode",{parentName:"p"},"torch.Size([])"),"? This is not true for ",Object(m.b)("em",{parentName:"p"},"multivariate")," distributions, that is, distributions over vectors, matrices, and higher-order tensors that can have dependencies across their dimensions. For example:"),Object(m.b)("pre",null,Object(m.b)("code",{parentName:"pre",className:"language-python"},"d = dist.MultivariateNormal(loc=torch.zeros(2, 5), covariance_matrix=torch.eye(5))\nsample_shape = torch.Size([3, 4])\n\n# Output: torch.Size([3, 4, 2, 5]) torch.Size([2]) torch.Size([5])\nprint(d.sample(sample_shape).shape, d.batch_shape, d.event_shape)\n")),Object(m.b)("p",null,"Note that the ",Object(m.b)("inlineCode",{parentName:"p"},"covariance_matrix")," tensor will be broadcast across ",Object(m.b)("inlineCode",{parentName:"p"},"loc"),". ",Object(m.b)("em",{parentName:"p"},"Whereas the previous example defined a matrix batch of scalar normal distributions, this example defines a vector batch of multivariate normal distributions.")," This is an important distinction!"),Object(m.b)("p",null,"See ",Object(m.b)("a",{parentName:"p",href:"https://ericmjl.github.io/blog/2019/5/29/reasoning-about-shapes-and-probability-distributions/"},"this page")," for further explanation on shape conventions."),Object(m.b)("h2",{id:"non-conditional-transformed-distributions"},"Non-conditional Transformed Distributions"),Object(m.b)("p",null,"How do shapes work for transformed distributions that do not condition on a context variable, that is, distributions of the form ",Object(m.b)("span",{parentName:"p",className:"math math-inline"},Object(m.b)("span",{parentName:"span",className:"katex"},Object(m.b)("span",{parentName:"span",className:"katex-mathml"},Object(m.b)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},Object(m.b)("semantics",{parentName:"math"},Object(m.b)("mrow",{parentName:"semantics"},Object(m.b)("msub",{parentName:"mrow"},Object(m.b)("mi",{parentName:"msub"},"p"),Object(m.b)("mi",{parentName:"msub"},"\u03b8")),Object(m.b)("mo",{parentName:"mrow",stretchy:"false"},"("),Object(m.b)("mi",{parentName:"mrow",mathvariant:"bold"},"x"),Object(m.b)("mo",{parentName:"mrow",stretchy:"false"},")")),Object(m.b)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"p_\\theta(\\mathbf{x})")))),Object(m.b)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},Object(m.b)("span",{parentName:"span",className:"base"},Object(m.b)("span",{parentName:"span",className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),Object(m.b)("span",{parentName:"span",className:"mord"},Object(m.b)("span",{parentName:"span",className:"mord mathnormal"},"p"),Object(m.b)("span",{parentName:"span",className:"msupsub"},Object(m.b)("span",{parentName:"span",className:"vlist-t vlist-t2"},Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.33610799999999996em"}},Object(m.b)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"0em",marginRight:"0.05em"}},Object(m.b)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),Object(m.b)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},Object(m.b)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.02778em"}},"\u03b8")))),Object(m.b)("span",{parentName:"span",className:"vlist-s"},"\u200b")),Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},Object(m.b)("span",{parentName:"span"})))))),Object(m.b)("span",{parentName:"span",className:"mopen"},"("),Object(m.b)("span",{parentName:"span",className:"mord"},Object(m.b)("span",{parentName:"span",className:"mord mathbf"},"x")),Object(m.b)("span",{parentName:"span",className:"mclose"},")"))))),"? The sample shape depends strictly on the input to ",Object(m.b)("inlineCode",{parentName:"p"},".sample")," or ",Object(m.b)("inlineCode",{parentName:"p"},".rsample")," and so we restrict our attention to the batch and event shapes."),Object(m.b)("p",null,"Returning to the diagram on the ",Object(m.b)("a",{parentName:"p",href:"/users"},"intro page"),", suppose the base distribution is ",Object(m.b)("span",{parentName:"p",className:"math math-inline"},Object(m.b)("span",{parentName:"span",className:"katex"},Object(m.b)("span",{parentName:"span",className:"katex-mathml"},Object(m.b)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},Object(m.b)("semantics",{parentName:"math"},Object(m.b)("mrow",{parentName:"semantics"},Object(m.b)("msub",{parentName:"mrow"},Object(m.b)("mi",{parentName:"msub"},"p"),Object(m.b)("mn",{parentName:"msub"},"0"))),Object(m.b)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"p_0")))),Object(m.b)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},Object(m.b)("span",{parentName:"span",className:"base"},Object(m.b)("span",{parentName:"span",className:"strut",style:{height:"0.625em",verticalAlign:"-0.19444em"}}),Object(m.b)("span",{parentName:"span",className:"mord"},Object(m.b)("span",{parentName:"span",className:"mord mathnormal"},"p"),Object(m.b)("span",{parentName:"span",className:"msupsub"},Object(m.b)("span",{parentName:"span",className:"vlist-t vlist-t2"},Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.30110799999999993em"}},Object(m.b)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"0em",marginRight:"0.05em"}},Object(m.b)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),Object(m.b)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},Object(m.b)("span",{parentName:"span",className:"mord mtight"},"0")))),Object(m.b)("span",{parentName:"span",className:"vlist-s"},"\u200b")),Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},Object(m.b)("span",{parentName:"span"})))))))))),", and the distribution after applying the the initial bijection, ",Object(m.b)("span",{parentName:"p",className:"math math-inline"},Object(m.b)("span",{parentName:"span",className:"katex"},Object(m.b)("span",{parentName:"span",className:"katex-mathml"},Object(m.b)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},Object(m.b)("semantics",{parentName:"math"},Object(m.b)("mrow",{parentName:"semantics"},Object(m.b)("msub",{parentName:"mrow"},Object(m.b)("mi",{parentName:"msub"},"f"),Object(m.b)("mn",{parentName:"msub"},"1"))),Object(m.b)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"f_1")))),Object(m.b)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},Object(m.b)("span",{parentName:"span",className:"base"},Object(m.b)("span",{parentName:"span",className:"strut",style:{height:"0.8888799999999999em",verticalAlign:"-0.19444em"}}),Object(m.b)("span",{parentName:"span",className:"mord"},Object(m.b)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.10764em"}},"f"),Object(m.b)("span",{parentName:"span",className:"msupsub"},Object(m.b)("span",{parentName:"span",className:"vlist-t vlist-t2"},Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.30110799999999993em"}},Object(m.b)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"-0.10764em",marginRight:"0.05em"}},Object(m.b)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),Object(m.b)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},Object(m.b)("span",{parentName:"span",className:"mord mtight"},"1")))),Object(m.b)("span",{parentName:"span",className:"vlist-s"},"\u200b")),Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},Object(m.b)("span",{parentName:"span"})))))))))),", is ",Object(m.b)("span",{parentName:"p",className:"math math-inline"},Object(m.b)("span",{parentName:"span",className:"katex"},Object(m.b)("span",{parentName:"span",className:"katex-mathml"},Object(m.b)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},Object(m.b)("semantics",{parentName:"math"},Object(m.b)("mrow",{parentName:"semantics"},Object(m.b)("msub",{parentName:"mrow"},Object(m.b)("mi",{parentName:"msub"},"p"),Object(m.b)("mn",{parentName:"msub"},"1"))),Object(m.b)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"p_1")))),Object(m.b)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},Object(m.b)("span",{parentName:"span",className:"base"},Object(m.b)("span",{parentName:"span",className:"strut",style:{height:"0.625em",verticalAlign:"-0.19444em"}}),Object(m.b)("span",{parentName:"span",className:"mord"},Object(m.b)("span",{parentName:"span",className:"mord mathnormal"},"p"),Object(m.b)("span",{parentName:"span",className:"msupsub"},Object(m.b)("span",{parentName:"span",className:"vlist-t vlist-t2"},Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.30110799999999993em"}},Object(m.b)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"0em",marginRight:"0.05em"}},Object(m.b)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),Object(m.b)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},Object(m.b)("span",{parentName:"span",className:"mord mtight"},"1")))),Object(m.b)("span",{parentName:"span",className:"vlist-s"},"\u200b")),Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},Object(m.b)("span",{parentName:"span"})))))))))),". Denote by ",Object(m.b)("span",{parentName:"p",className:"math math-inline"},Object(m.b)("span",{parentName:"span",className:"katex"},Object(m.b)("span",{parentName:"span",className:"katex-mathml"},Object(m.b)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},Object(m.b)("semantics",{parentName:"math"},Object(m.b)("mrow",{parentName:"semantics"},Object(m.b)("msub",{parentName:"mrow"},Object(m.b)("mi",{parentName:"msub"},"z"),Object(m.b)("mn",{parentName:"msub"},"0"))),Object(m.b)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"z_0")))),Object(m.b)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},Object(m.b)("span",{parentName:"span",className:"base"},Object(m.b)("span",{parentName:"span",className:"strut",style:{height:"0.58056em",verticalAlign:"-0.15em"}}),Object(m.b)("span",{parentName:"span",className:"mord"},Object(m.b)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.04398em"}},"z"),Object(m.b)("span",{parentName:"span",className:"msupsub"},Object(m.b)("span",{parentName:"span",className:"vlist-t vlist-t2"},Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.30110799999999993em"}},Object(m.b)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"-0.04398em",marginRight:"0.05em"}},Object(m.b)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),Object(m.b)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},Object(m.b)("span",{parentName:"span",className:"mord mtight"},"0")))),Object(m.b)("span",{parentName:"span",className:"vlist-s"},"\u200b")),Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},Object(m.b)("span",{parentName:"span"}))))))))))," a sample from the base distribution and ",Object(m.b)("span",{parentName:"p",className:"math math-inline"},Object(m.b)("span",{parentName:"span",className:"katex"},Object(m.b)("span",{parentName:"span",className:"katex-mathml"},Object(m.b)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},Object(m.b)("semantics",{parentName:"math"},Object(m.b)("mrow",{parentName:"semantics"},Object(m.b)("msub",{parentName:"mrow"},Object(m.b)("mi",{parentName:"msub"},"z"),Object(m.b)("mn",{parentName:"msub"},"1")),Object(m.b)("mo",{parentName:"mrow"},"="),Object(m.b)("msub",{parentName:"mrow"},Object(m.b)("mi",{parentName:"msub"},"f"),Object(m.b)("mn",{parentName:"msub"},"1")),Object(m.b)("mo",{parentName:"mrow",stretchy:"false"},"("),Object(m.b)("msub",{parentName:"mrow"},Object(m.b)("mi",{parentName:"msub"},"z"),Object(m.b)("mn",{parentName:"msub"},"0")),Object(m.b)("mo",{parentName:"mrow",stretchy:"false"},")")),Object(m.b)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"z_1=f_1(z_0)")))),Object(m.b)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},Object(m.b)("span",{parentName:"span",className:"base"},Object(m.b)("span",{parentName:"span",className:"strut",style:{height:"0.58056em",verticalAlign:"-0.15em"}}),Object(m.b)("span",{parentName:"span",className:"mord"},Object(m.b)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.04398em"}},"z"),Object(m.b)("span",{parentName:"span",className:"msupsub"},Object(m.b)("span",{parentName:"span",className:"vlist-t vlist-t2"},Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.30110799999999993em"}},Object(m.b)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"-0.04398em",marginRight:"0.05em"}},Object(m.b)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),Object(m.b)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},Object(m.b)("span",{parentName:"span",className:"mord mtight"},"1")))),Object(m.b)("span",{parentName:"span",className:"vlist-s"},"\u200b")),Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},Object(m.b)("span",{parentName:"span"})))))),Object(m.b)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}}),Object(m.b)("span",{parentName:"span",className:"mrel"},"="),Object(m.b)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}})),Object(m.b)("span",{parentName:"span",className:"base"},Object(m.b)("span",{parentName:"span",className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),Object(m.b)("span",{parentName:"span",className:"mord"},Object(m.b)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.10764em"}},"f"),Object(m.b)("span",{parentName:"span",className:"msupsub"},Object(m.b)("span",{parentName:"span",className:"vlist-t vlist-t2"},Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.30110799999999993em"}},Object(m.b)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"-0.10764em",marginRight:"0.05em"}},Object(m.b)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),Object(m.b)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},Object(m.b)("span",{parentName:"span",className:"mord mtight"},"1")))),Object(m.b)("span",{parentName:"span",className:"vlist-s"},"\u200b")),Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},Object(m.b)("span",{parentName:"span"})))))),Object(m.b)("span",{parentName:"span",className:"mopen"},"("),Object(m.b)("span",{parentName:"span",className:"mord"},Object(m.b)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.04398em"}},"z"),Object(m.b)("span",{parentName:"span",className:"msupsub"},Object(m.b)("span",{parentName:"span",className:"vlist-t vlist-t2"},Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.30110799999999993em"}},Object(m.b)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"-0.04398em",marginRight:"0.05em"}},Object(m.b)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),Object(m.b)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},Object(m.b)("span",{parentName:"span",className:"mord mtight"},"0")))),Object(m.b)("span",{parentName:"span",className:"vlist-s"},"\u200b")),Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},Object(m.b)("span",{parentName:"span"})))))),Object(m.b)("span",{parentName:"span",className:"mclose"},")"))))),". We make a few observations:"),Object(m.b)("p",null,"Firstly, since ",Object(m.b)("span",{parentName:"p",className:"math math-inline"},Object(m.b)("span",{parentName:"span",className:"katex"},Object(m.b)("span",{parentName:"span",className:"katex-mathml"},Object(m.b)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},Object(m.b)("semantics",{parentName:"math"},Object(m.b)("mrow",{parentName:"semantics"},Object(m.b)("msub",{parentName:"mrow"},Object(m.b)("mi",{parentName:"msub"},"f"),Object(m.b)("mn",{parentName:"msub"},"1"))),Object(m.b)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"f_1")))),Object(m.b)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},Object(m.b)("span",{parentName:"span",className:"base"},Object(m.b)("span",{parentName:"span",className:"strut",style:{height:"0.8888799999999999em",verticalAlign:"-0.19444em"}}),Object(m.b)("span",{parentName:"span",className:"mord"},Object(m.b)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.10764em"}},"f"),Object(m.b)("span",{parentName:"span",className:"msupsub"},Object(m.b)("span",{parentName:"span",className:"vlist-t vlist-t2"},Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.30110799999999993em"}},Object(m.b)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"-0.10764em",marginRight:"0.05em"}},Object(m.b)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),Object(m.b)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},Object(m.b)("span",{parentName:"span",className:"mord mtight"},"1")))),Object(m.b)("span",{parentName:"span",className:"vlist-s"},"\u200b")),Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},Object(m.b)("span",{parentName:"span"}))))))))))," is a bijection, ",Object(m.b)("span",{parentName:"p",className:"math math-inline"},Object(m.b)("span",{parentName:"span",className:"katex"},Object(m.b)("span",{parentName:"span",className:"katex-mathml"},Object(m.b)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},Object(m.b)("semantics",{parentName:"math"},Object(m.b)("mrow",{parentName:"semantics"},Object(m.b)("msub",{parentName:"mrow"},Object(m.b)("mi",{parentName:"msub"},"z"),Object(m.b)("mn",{parentName:"msub"},"0"))),Object(m.b)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"z_0")))),Object(m.b)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},Object(m.b)("span",{parentName:"span",className:"base"},Object(m.b)("span",{parentName:"span",className:"strut",style:{height:"0.58056em",verticalAlign:"-0.15em"}}),Object(m.b)("span",{parentName:"span",className:"mord"},Object(m.b)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.04398em"}},"z"),Object(m.b)("span",{parentName:"span",className:"msupsub"},Object(m.b)("span",{parentName:"span",className:"vlist-t vlist-t2"},Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.30110799999999993em"}},Object(m.b)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"-0.04398em",marginRight:"0.05em"}},Object(m.b)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),Object(m.b)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},Object(m.b)("span",{parentName:"span",className:"mord mtight"},"0")))),Object(m.b)("span",{parentName:"span",className:"vlist-s"},"\u200b")),Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},Object(m.b)("span",{parentName:"span"}))))))))))," must have the same number of dimensions as ",Object(m.b)("span",{parentName:"p",className:"math math-inline"},Object(m.b)("span",{parentName:"span",className:"katex"},Object(m.b)("span",{parentName:"span",className:"katex-mathml"},Object(m.b)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},Object(m.b)("semantics",{parentName:"math"},Object(m.b)("mrow",{parentName:"semantics"},Object(m.b)("msub",{parentName:"mrow"},Object(m.b)("mi",{parentName:"msub"},"z"),Object(m.b)("mn",{parentName:"msub"},"1"))),Object(m.b)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"z_1")))),Object(m.b)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},Object(m.b)("span",{parentName:"span",className:"base"},Object(m.b)("span",{parentName:"span",className:"strut",style:{height:"0.58056em",verticalAlign:"-0.15em"}}),Object(m.b)("span",{parentName:"span",className:"mord"},Object(m.b)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.04398em"}},"z"),Object(m.b)("span",{parentName:"span",className:"msupsub"},Object(m.b)("span",{parentName:"span",className:"vlist-t vlist-t2"},Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.30110799999999993em"}},Object(m.b)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"-0.04398em",marginRight:"0.05em"}},Object(m.b)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),Object(m.b)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},Object(m.b)("span",{parentName:"span",className:"mord mtight"},"1")))),Object(m.b)("span",{parentName:"span",className:"vlist-s"},"\u200b")),Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},Object(m.b)("span",{parentName:"span"})))))))))),". In our shape terminology, the sum of the event shape of the base distribution must be the same as the sum of the event shape of the transformed one."),Object(m.b)("p",null,"Secondly, the batch shape is preserved from the base distribution to transformed one. ",Object(m.b)("em",{parentName:"p"},"By convention, we assume that a single bijection, ",Object(m.b)("span",{parentName:"em",className:"math math-inline"},Object(m.b)("span",{parentName:"span",className:"katex"},Object(m.b)("span",{parentName:"span",className:"katex-mathml"},Object(m.b)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},Object(m.b)("semantics",{parentName:"math"},Object(m.b)("mrow",{parentName:"semantics"},Object(m.b)("msub",{parentName:"mrow"},Object(m.b)("mi",{parentName:"msub"},"f"),Object(m.b)("mn",{parentName:"msub"},"1"))),Object(m.b)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"f_1")))),Object(m.b)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},Object(m.b)("span",{parentName:"span",className:"base"},Object(m.b)("span",{parentName:"span",className:"strut",style:{height:"0.8888799999999999em",verticalAlign:"-0.19444em"}}),Object(m.b)("span",{parentName:"span",className:"mord"},Object(m.b)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.10764em"}},"f"),Object(m.b)("span",{parentName:"span",className:"msupsub"},Object(m.b)("span",{parentName:"span",className:"vlist-t vlist-t2"},Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.30110799999999993em"}},Object(m.b)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"-0.10764em",marginRight:"0.05em"}},Object(m.b)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),Object(m.b)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},Object(m.b)("span",{parentName:"span",className:"mord mtight"},"1")))),Object(m.b)("span",{parentName:"span",className:"vlist-s"},"\u200b")),Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},Object(m.b)("span",{parentName:"span"})))))))))),", is applied to a batch of base distributions, ",Object(m.b)("span",{parentName:"em",className:"math math-inline"},Object(m.b)("span",{parentName:"span",className:"katex"},Object(m.b)("span",{parentName:"span",className:"katex-mathml"},Object(m.b)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},Object(m.b)("semantics",{parentName:"math"},Object(m.b)("mrow",{parentName:"semantics"},Object(m.b)("mo",{parentName:"mrow",stretchy:"false"},"{"),Object(m.b)("msub",{parentName:"mrow"},Object(m.b)("mi",{parentName:"msub"},"p"),Object(m.b)("mrow",{parentName:"msub"},Object(m.b)("mn",{parentName:"mrow"},"0"),Object(m.b)("mo",{parentName:"mrow",separator:"true"},","),Object(m.b)("mi",{parentName:"mrow"},"i"))),Object(m.b)("mo",{parentName:"mrow",stretchy:"false"},"}")),Object(m.b)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"\\{p_{0,i}\\}")))),Object(m.b)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},Object(m.b)("span",{parentName:"span",className:"base"},Object(m.b)("span",{parentName:"span",className:"strut",style:{height:"1.036108em",verticalAlign:"-0.286108em"}}),Object(m.b)("span",{parentName:"span",className:"mopen"},"{"),Object(m.b)("span",{parentName:"span",className:"mord"},Object(m.b)("span",{parentName:"span",className:"mord mathnormal"},"p"),Object(m.b)("span",{parentName:"span",className:"msupsub"},Object(m.b)("span",{parentName:"span",className:"vlist-t vlist-t2"},Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.311664em"}},Object(m.b)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"0em",marginRight:"0.05em"}},Object(m.b)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),Object(m.b)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},Object(m.b)("span",{parentName:"span",className:"mord mtight"},Object(m.b)("span",{parentName:"span",className:"mord mtight"},"0"),Object(m.b)("span",{parentName:"span",className:"mpunct mtight"},","),Object(m.b)("span",{parentName:"span",className:"mord mathnormal mtight"},"i"))))),Object(m.b)("span",{parentName:"span",className:"vlist-s"},"\u200b")),Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.286108em"}},Object(m.b)("span",{parentName:"span"})))))),Object(m.b)("span",{parentName:"span",className:"mclose"},"}"))))),", to produce a batch of the same shape of transformed distributions, ",Object(m.b)("span",{parentName:"em",className:"math math-inline"},Object(m.b)("span",{parentName:"span",className:"katex"},Object(m.b)("span",{parentName:"span",className:"katex-mathml"},Object(m.b)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},Object(m.b)("semantics",{parentName:"math"},Object(m.b)("mrow",{parentName:"semantics"},Object(m.b)("mo",{parentName:"mrow",stretchy:"false"},"{"),Object(m.b)("msub",{parentName:"mrow"},Object(m.b)("mi",{parentName:"msub"},"p"),Object(m.b)("mrow",{parentName:"msub"},Object(m.b)("mn",{parentName:"mrow"},"1"),Object(m.b)("mo",{parentName:"mrow",separator:"true"},","),Object(m.b)("mi",{parentName:"mrow"},"i"))),Object(m.b)("mo",{parentName:"mrow",stretchy:"false"},"}")),Object(m.b)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"\\{p_{1,i}\\}")))),Object(m.b)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},Object(m.b)("span",{parentName:"span",className:"base"},Object(m.b)("span",{parentName:"span",className:"strut",style:{height:"1.036108em",verticalAlign:"-0.286108em"}}),Object(m.b)("span",{parentName:"span",className:"mopen"},"{"),Object(m.b)("span",{parentName:"span",className:"mord"},Object(m.b)("span",{parentName:"span",className:"mord mathnormal"},"p"),Object(m.b)("span",{parentName:"span",className:"msupsub"},Object(m.b)("span",{parentName:"span",className:"vlist-t vlist-t2"},Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.311664em"}},Object(m.b)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"0em",marginRight:"0.05em"}},Object(m.b)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),Object(m.b)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},Object(m.b)("span",{parentName:"span",className:"mord mtight"},Object(m.b)("span",{parentName:"span",className:"mord mtight"},"1"),Object(m.b)("span",{parentName:"span",className:"mpunct mtight"},","),Object(m.b)("span",{parentName:"span",className:"mord mathnormal mtight"},"i"))))),Object(m.b)("span",{parentName:"span",className:"vlist-s"},"\u200b")),Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.286108em"}},Object(m.b)("span",{parentName:"span"})))))),Object(m.b)("span",{parentName:"span",className:"mclose"},"}"))))),".")),Object(m.b)("p",null,"Thirdly, the event shape of the base distribution must be compatible with the domain of the bijection. For instance, if the base distribution has event shape ",Object(m.b)("inlineCode",{parentName:"p"},"torch.Size([])")," and is a scalar, it does not make sense to applied a bijection on matrices with, e.g., ",Object(m.b)("span",{parentName:"p",className:"math math-inline"},Object(m.b)("span",{parentName:"span",className:"katex"},Object(m.b)("span",{parentName:"span",className:"katex-mathml"},Object(m.b)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},Object(m.b)("semantics",{parentName:"math"},Object(m.b)("mrow",{parentName:"semantics"},Object(m.b)("mtext",{parentName:"mrow"},"Dom"),Object(m.b)("mo",{parentName:"mrow",stretchy:"false"},"["),Object(m.b)("msub",{parentName:"mrow"},Object(m.b)("mi",{parentName:"msub"},"f"),Object(m.b)("mn",{parentName:"msub"},"1")),Object(m.b)("mo",{parentName:"mrow",stretchy:"false"},"]"),Object(m.b)("mo",{parentName:"mrow"},"\u2286"),Object(m.b)("msup",{parentName:"mrow"},Object(m.b)("mi",{parentName:"msup",mathvariant:"double-struck"},"R"),Object(m.b)("mrow",{parentName:"msup"},Object(m.b)("mi",{parentName:"mrow"},"n"),Object(m.b)("mo",{parentName:"mrow"},"\xd7"),Object(m.b)("mi",{parentName:"mrow"},"m")))),Object(m.b)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"\\text{Dom}[f_1]\\subseteq \\mathbb{R}^{n\\times m}")))),Object(m.b)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},Object(m.b)("span",{parentName:"span",className:"base"},Object(m.b)("span",{parentName:"span",className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),Object(m.b)("span",{parentName:"span",className:"mord text"},Object(m.b)("span",{parentName:"span",className:"mord"},"Dom")),Object(m.b)("span",{parentName:"span",className:"mopen"},"["),Object(m.b)("span",{parentName:"span",className:"mord"},Object(m.b)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.10764em"}},"f"),Object(m.b)("span",{parentName:"span",className:"msupsub"},Object(m.b)("span",{parentName:"span",className:"vlist-t vlist-t2"},Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.30110799999999993em"}},Object(m.b)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"-0.10764em",marginRight:"0.05em"}},Object(m.b)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),Object(m.b)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},Object(m.b)("span",{parentName:"span",className:"mord mtight"},"1")))),Object(m.b)("span",{parentName:"span",className:"vlist-s"},"\u200b")),Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},Object(m.b)("span",{parentName:"span"})))))),Object(m.b)("span",{parentName:"span",className:"mclose"},"]"),Object(m.b)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}}),Object(m.b)("span",{parentName:"span",className:"mrel"},"\u2286"),Object(m.b)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}})),Object(m.b)("span",{parentName:"span",className:"base"},Object(m.b)("span",{parentName:"span",className:"strut",style:{height:"0.771331em",verticalAlign:"0em"}}),Object(m.b)("span",{parentName:"span",className:"mord"},Object(m.b)("span",{parentName:"span",className:"mord"},Object(m.b)("span",{parentName:"span",className:"mord mathbb"},"R")),Object(m.b)("span",{parentName:"span",className:"msupsub"},Object(m.b)("span",{parentName:"span",className:"vlist-t"},Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.771331em"}},Object(m.b)("span",{parentName:"span",style:{top:"-3.063em",marginRight:"0.05em"}},Object(m.b)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),Object(m.b)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},Object(m.b)("span",{parentName:"span",className:"mord mtight"},Object(m.b)("span",{parentName:"span",className:"mord mathnormal mtight"},"n"),Object(m.b)("span",{parentName:"span",className:"mbin mtight"},"\xd7"),Object(m.b)("span",{parentName:"span",className:"mord mathnormal mtight"},"m"))))))))))))),"."),Object(m.b)("p",null,"Given a base distribution, ",Object(m.b)("inlineCode",{parentName:"p"},"base"),", and a non-conditional bijector ",Object(m.b)("inlineCode",{parentName:"p"},"bijector"),", the pseudo-code to calculate the batch and event shape of the transformed distribution, ",Object(m.b)("inlineCode",{parentName:"p"},"transformed"),", looks like this:"),Object(m.b)("pre",null,Object(m.b)("code",{parentName:"pre",className:"language-python"},"# Input event shape must have at least as many dimensions as that which bijector operates over\nassert len(base.event_shape) >= bijector.domain.event_dim\n\ntransformed.batch_shape = base.batch_shape\ntransformed.event_shape = bijector.forward_shape(base.event_shape)\n\n# bijector.forward_shape and bijector.codomain.event_dim must be consistent\nassert len(transformed.event_shape) >= bijector.codomain.event_dim\n\n# bijectors preserve dimensions\nassert sum(transformed.event_shape) == sum(base.event_shape)\n")),Object(m.b)("p",null,"The ",Object(m.b)("inlineCode",{parentName:"p"},"bijector")," class defines the number of dimensions that it operates over in ",Object(m.b)("inlineCode",{parentName:"p"},"bijector.domain.event_dim")," and ",Object(m.b)("inlineCode",{parentName:"p"},"bijector.codomain.event_dim"),", and has a method ",Object(m.b)("inlineCode",{parentName:"p"},"bijector.forward_shape")," that specifies how the event shape of the input relates to that of the output. (In most cases, this will be the identity function.)"),Object(m.b)("p",null,"This information is sufficient to construct the batch and event shapes of the transformed distribution from the base. For a Normalizing Flow that is the composition of multiple bijections, we apply this logic in succession, using the transformed distribution of the previous step as the base distribution of the next."),Object(m.b)("h2",{id:"conditional-transformed-distributions"},"Conditional Transformed Distributions"),Object(m.b)("p",null,"How do shapes work for conditional transformed distributions of the form ",Object(m.b)("span",{parentName:"p",className:"math math-inline"},Object(m.b)("span",{parentName:"span",className:"katex"},Object(m.b)("span",{parentName:"span",className:"katex-mathml"},Object(m.b)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},Object(m.b)("semantics",{parentName:"math"},Object(m.b)("mrow",{parentName:"semantics"},Object(m.b)("msub",{parentName:"mrow"},Object(m.b)("mi",{parentName:"msub"},"p"),Object(m.b)("mi",{parentName:"msub"},"\u03b8")),Object(m.b)("mo",{parentName:"mrow",stretchy:"false"},"("),Object(m.b)("mi",{parentName:"mrow",mathvariant:"bold"},"x"),Object(m.b)("mo",{parentName:"mrow"},"\u2223"),Object(m.b)("msup",{parentName:"mrow"},Object(m.b)("mi",{parentName:"msup",mathvariant:"bold"},"z"),Object(m.b)("mo",{parentName:"msup",mathvariant:"normal",lspace:"0em",rspace:"0em"},"\u2032")),Object(m.b)("mo",{parentName:"mrow",stretchy:"false"},")")),Object(m.b)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"p_\\theta(\\mathbf{x}\\mid\\mathbf{z}')")))),Object(m.b)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},Object(m.b)("span",{parentName:"span",className:"base"},Object(m.b)("span",{parentName:"span",className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),Object(m.b)("span",{parentName:"span",className:"mord"},Object(m.b)("span",{parentName:"span",className:"mord mathnormal"},"p"),Object(m.b)("span",{parentName:"span",className:"msupsub"},Object(m.b)("span",{parentName:"span",className:"vlist-t vlist-t2"},Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.33610799999999996em"}},Object(m.b)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"0em",marginRight:"0.05em"}},Object(m.b)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),Object(m.b)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},Object(m.b)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.02778em"}},"\u03b8")))),Object(m.b)("span",{parentName:"span",className:"vlist-s"},"\u200b")),Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},Object(m.b)("span",{parentName:"span"})))))),Object(m.b)("span",{parentName:"span",className:"mopen"},"("),Object(m.b)("span",{parentName:"span",className:"mord"},Object(m.b)("span",{parentName:"span",className:"mord mathbf"},"x")),Object(m.b)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}}),Object(m.b)("span",{parentName:"span",className:"mrel"},"\u2223"),Object(m.b)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}})),Object(m.b)("span",{parentName:"span",className:"base"},Object(m.b)("span",{parentName:"span",className:"strut",style:{height:"1.001892em",verticalAlign:"-0.25em"}}),Object(m.b)("span",{parentName:"span",className:"mord"},Object(m.b)("span",{parentName:"span",className:"mord"},Object(m.b)("span",{parentName:"span",className:"mord mathbf"},"z")),Object(m.b)("span",{parentName:"span",className:"msupsub"},Object(m.b)("span",{parentName:"span",className:"vlist-t"},Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.751892em"}},Object(m.b)("span",{parentName:"span",style:{top:"-3.063em",marginRight:"0.05em"}},Object(m.b)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),Object(m.b)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},Object(m.b)("span",{parentName:"span",className:"mord mtight"},Object(m.b)("span",{parentName:"span",className:"mord mtight"},"\u2032"))))))))),Object(m.b)("span",{parentName:"span",className:"mclose"},")"))))),"? Again, we restrict our attention to the batch and event shapes. Let's denote the base distribution of ",Object(m.b)("span",{parentName:"p",className:"math math-inline"},Object(m.b)("span",{parentName:"span",className:"katex"},Object(m.b)("span",{parentName:"span",className:"katex-mathml"},Object(m.b)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},Object(m.b)("semantics",{parentName:"math"},Object(m.b)("mrow",{parentName:"semantics"},Object(m.b)("msub",{parentName:"mrow"},Object(m.b)("mi",{parentName:"msub",mathvariant:"bold"},"z"),Object(m.b)("mn",{parentName:"msub",mathvariant:"bold"},"0"))),Object(m.b)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"\\mathbf{z_0}")))),Object(m.b)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},Object(m.b)("span",{parentName:"span",className:"base"},Object(m.b)("span",{parentName:"span",className:"strut",style:{height:"0.59444em",verticalAlign:"-0.15em"}}),Object(m.b)("span",{parentName:"span",className:"mord"},Object(m.b)("span",{parentName:"span",className:"mord"},Object(m.b)("span",{parentName:"span",className:"mord mathbf"},"z"),Object(m.b)("span",{parentName:"span",className:"msupsub"},Object(m.b)("span",{parentName:"span",className:"vlist-t vlist-t2"},Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.30110799999999993em"}},Object(m.b)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"0em",marginRight:"0.05em"}},Object(m.b)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),Object(m.b)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},Object(m.b)("span",{parentName:"span",className:"mord mathbf mtight"},"0")))),Object(m.b)("span",{parentName:"span",className:"vlist-s"},"\u200b")),Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},Object(m.b)("span",{parentName:"span"})))))))))))," by ",Object(m.b)("inlineCode",{parentName:"p"},"base"),", the transformed distribution of ",Object(m.b)("span",{parentName:"p",className:"math math-inline"},Object(m.b)("span",{parentName:"span",className:"katex"},Object(m.b)("span",{parentName:"span",className:"katex-mathml"},Object(m.b)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},Object(m.b)("semantics",{parentName:"math"},Object(m.b)("mrow",{parentName:"semantics"},Object(m.b)("msub",{parentName:"mrow"},Object(m.b)("mi",{parentName:"msub",mathvariant:"bold"},"z"),Object(m.b)("mn",{parentName:"msub",mathvariant:"bold"},"1"))),Object(m.b)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"\\mathbf{z_1}")))),Object(m.b)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},Object(m.b)("span",{parentName:"span",className:"base"},Object(m.b)("span",{parentName:"span",className:"strut",style:{height:"0.59444em",verticalAlign:"-0.15em"}}),Object(m.b)("span",{parentName:"span",className:"mord"},Object(m.b)("span",{parentName:"span",className:"mord"},Object(m.b)("span",{parentName:"span",className:"mord mathbf"},"z"),Object(m.b)("span",{parentName:"span",className:"msupsub"},Object(m.b)("span",{parentName:"span",className:"vlist-t vlist-t2"},Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.30110799999999993em"}},Object(m.b)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"0em",marginRight:"0.05em"}},Object(m.b)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),Object(m.b)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},Object(m.b)("span",{parentName:"span",className:"mord mathbf mtight"},"1")))),Object(m.b)("span",{parentName:"span",className:"vlist-s"},"\u200b")),Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},Object(m.b)("span",{parentName:"span"})))))))))))," by ",Object(m.b)("inlineCode",{parentName:"p"},"transformed"),", and the context distribution of ",Object(m.b)("span",{parentName:"p",className:"math math-inline"},Object(m.b)("span",{parentName:"span",className:"katex"},Object(m.b)("span",{parentName:"span",className:"katex-mathml"},Object(m.b)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},Object(m.b)("semantics",{parentName:"math"},Object(m.b)("mrow",{parentName:"semantics"},Object(m.b)("msup",{parentName:"mrow"},Object(m.b)("mi",{parentName:"msup",mathvariant:"bold"},"z"),Object(m.b)("mo",{parentName:"msup",mathvariant:"normal",lspace:"0em",rspace:"0em"},"\u2032"))),Object(m.b)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"\\mathbf{z}'")))),Object(m.b)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},Object(m.b)("span",{parentName:"span",className:"base"},Object(m.b)("span",{parentName:"span",className:"strut",style:{height:"0.751892em",verticalAlign:"0em"}}),Object(m.b)("span",{parentName:"span",className:"mord"},Object(m.b)("span",{parentName:"span",className:"mord"},Object(m.b)("span",{parentName:"span",className:"mord mathbf"},"z")),Object(m.b)("span",{parentName:"span",className:"msupsub"},Object(m.b)("span",{parentName:"span",className:"vlist-t"},Object(m.b)("span",{parentName:"span",className:"vlist-r"},Object(m.b)("span",{parentName:"span",className:"vlist",style:{height:"0.751892em"}},Object(m.b)("span",{parentName:"span",style:{top:"-3.063em",marginRight:"0.05em"}},Object(m.b)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),Object(m.b)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},Object(m.b)("span",{parentName:"span",className:"mord mtight"},Object(m.b)("span",{parentName:"span",className:"mord mtight"},"\u2032")))))))))))))," by ",Object(m.b)("inlineCode",{parentName:"p"},"context"),"."),Object(m.b)("p",null,"When ",Object(m.b)("inlineCode",{parentName:"p"},"base.batch_shape = context.batch_shape = torch.Size([])")," and, for example, ",Object(m.b)("inlineCode",{parentName:"p"},"base.event_shape = torch.Size([10])"),", ",Object(m.b)("inlineCode",{parentName:"p"},"context.event_shape = torch.Size([5])"),", clearly ",Object(m.b)("inlineCode",{parentName:"p"},"transformed.batch_shape = torch.Size([])")," and ",Object(m.b)("inlineCode",{parentName:"p"},"transformed.event_shape[10]"),". We see from this that the event shape of the context distribution should not effect the transformed one, which takes its event shape from the base."),Object(m.b)("p",null,"But what about the batch shape? Suppose ",Object(m.b)("inlineCode",{parentName:"p"},"base.batch_shape = torch.Size([1])"),", ",Object(m.b)("inlineCode",{parentName:"p"},"context.batch_shape = torch.Size([2])"),", and the event shapes are as previously. Should ",Object(m.b)("inlineCode",{parentName:"p"},"transformed.batch_shape = torch.Size([1,2])"),", ",Object(m.b)("inlineCode",{parentName:"p"},"transformed.batch_shape = torch.Size([2,1])"),", ",Object(m.b)("inlineCode",{parentName:"p"},"transformed.batch_shape = torch.Size([2])"),", or some other possibility such as throwing an exception?"),Object(m.b)("p",null,Object(m.b)("em",{parentName:"p"},"We define as the most sensible default that ",Object(m.b)("inlineCode",{parentName:"em"},"transformed.batch_shape")," is the broadcasting of ",Object(m.b)("inlineCode",{parentName:"em"},"base.batch_shape")," over ",Object(m.b)("inlineCode",{parentName:"em"},"context.batch_shape"),".")," In this case, this means that ",Object(m.b)("inlineCode",{parentName:"p"},"transformed.batch_shape = torch.Size([2])"),". "),Object(m.b)("p",null,"We believe this makes the most sense over other design choices since we can recover the cases where ",Object(m.b)("inlineCode",{parentName:"p"},"transformed.batch_shape")," is the concatenation of the base and context batch sizes as a special case, e.g. when ",Object(m.b)("inlineCode",{parentName:"p"},"base.batch_shape = torch.Size([1])"),", ",Object(m.b)("inlineCode",{parentName:"p"},"context.batch_shape = torch.Size([2, 1])"),". "),Object(m.b)("p",null,"Pseudo-code for calculating the shapes of the transformed distribution in the conditional case looks as follows:"),Object(m.b)("pre",null,Object(m.b)("code",{parentName:"pre",className:"language-python"},"x = torch.empty(base.batch_shape)\ny = torch.empty(context.batch_shape)\ntransformed.batch_shape = (x*y).shape\n\ntransformed.event_shape = bijector.forward_shape(base.event_shape)\n")),Object(m.b)("p",null,"Of course, if the shapes cannot be broadcast over each other then an exception will be thrown."))}l.isMDXComponent=!0},168:function(e,a,t){"use strict";t.d(a,"a",(function(){return l})),t.d(a,"b",(function(){return h}));var s=t(0),n=t.n(s);function m(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function p(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);a&&(s=s.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,s)}return t}function b(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?p(Object(t),!0).forEach((function(a){m(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):p(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function r(e,a){if(null==e)return{};var t,s,n=function(e,a){if(null==e)return{};var t,s,n={},m=Object.keys(e);for(s=0;s<m.length;s++)t=m[s],a.indexOf(t)>=0||(n[t]=e[t]);return n}(e,a);if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(e);for(s=0;s<m.length;s++)t=m[s],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(n[t]=e[t])}return n}var c=n.a.createContext({}),i=function(e){var a=n.a.useContext(c),t=a;return e&&(t="function"==typeof e?e(a):b(b({},a),e)),t},l=function(e){var a=i(e.components);return n.a.createElement(c.Provider,{value:a},e.children)},N={inlineCode:"code",wrapper:function(e){var a=e.children;return n.a.createElement(n.a.Fragment,{},a)}},o=n.a.forwardRef((function(e,a){var t=e.components,s=e.mdxType,m=e.originalType,p=e.parentName,c=r(e,["components","mdxType","originalType","parentName"]),l=i(t),o=s,h=l["".concat(p,".").concat(o)]||l[o]||N[o]||m;return t?n.a.createElement(h,b(b({ref:a},c),{},{components:t})):n.a.createElement(h,b({ref:a},c))}));function h(e,a){var t=arguments,s=a&&a.mdxType;if("string"==typeof e||s){var m=t.length,p=new Array(m);p[0]=o;var b={};for(var r in a)hasOwnProperty.call(a,r)&&(b[r]=a[r]);b.originalType=e,b.mdxType="string"==typeof e?e:s,p[1]=b;for(var c=2;c<m;c++)p[c]=t[c];return n.a.createElement.apply(null,p)}return n.a.createElement.apply(null,t)}o.displayName="MDXCreateElement"}}]);